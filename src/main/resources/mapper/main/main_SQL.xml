<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mainPage">

   <!-- 메인 카테고리 -->
   <select id="category" parameterType='hashmap'
      resultType="hashmap">
      <![CDATA[
		   SELECT
	       		  SUBSTR(COMD_CODE,'1','1')  AS PARENTS_CODE							/* 부모 카테고리 코드 */
	     		, COMD_CODE AS CHILD_CODE												/* 자식 카테고리 코드 */
	     		, GETCODENAME('CATE_IDXX',SUBSTR(COMD_CODE,'1','1')) AS PARENTS_CATE	/* 부모 카테고리 이름 */
	     		, COMD_NAME AS CHILD_CATE    											/* 자식 카테고리 이름 */
	     		, CODE_OPT1 AS CATE_PATH												/* 자식 카테고리 경로 */
	     		, CODE_OPT2 AS IMAG_SRCC												/* 자식 카테고리 이미지 경로 */
	 		FROM TB_CODEXD
		   WHERE COMM_CODE = 'CATE_IDXX'
		ORDER BY COMD_CODE
	 ]]>
   </select>
   
   <!-- 로그인 메인화면 -->
   <select id="mainLoginGather" parameterType='hashmap'
      resultType="hashmap">
      <![CDATA[
         SELECT /*로그인 메인화면*/
         		  RNUM
                , TYPE                
                , GATH_IDXX
                , GATH_TITL
                , GATH_CNTT
                , GATH_IMAG
                , CATE_IDXX
                , PARENTS_CATE
                , CHILD_CATE
                , PRES_PEOP
                , APPR_YSNO
                , MOIM_AGEE
                , APPR_GNDR
                , REGI_NAME
                , USER_NICK
                , USER_IMAG
                , SMAL_DATE
                , FULL_DATE
                , LIKE_COUNT
                , REGG_DATE
             FROM (
                  	(
                    	SELECT  ROW_NUMBER() OVER (ORDER BY REGG_DATE DESC) RNUM
                              , 'Taste' AS TYPE
                    		  , GATH_IDXX
                    		  , GATH_TITL
                    		  , GATH_CNTT
		                      , GATH_IMAG
		                      , CATE_IDXX
		                      , PARENTS_CATE
		                      , CHILD_CATE
		                      , PRES_PEOP
		                      , APPR_YSNO
		                      , MOIM_AGEE
		                      , APPR_GNDR
		                      , REGI_NAME
		                      , USER_NICK
		                      , USER_IMAG
		                      , SMAL_DATE
		                      , FULL_DATE
		                      , LIKE_COUNT
		                      , REGG_DATE
		                   FROM VW_GATHER
		                  WHERE CATE_IDXX IN ( 
                                    		  SELECT CATE_IDXX
                                       			FROM TB_URCATE
                                      		   WHERE USER_NUMB = 'UR23120001')
                 )
        UNION ALL
                (
		        			SELECT ROW_NUMBER() OVER (ORDER BY REGG_DATE DESC) RNUM
			                     ,'Hot' AS TYPE
			                     , GATH_IDXX
			                     , GATH_TITL
			                     , GATH_CNTT
			                     , GATH_IMAG
			                     , CATE_IDXX
			                     , PARENTS_CATE
			                     , CHILD_CATE
			                     , PRES_PEOP
			                     , APPR_YSNO
			                     , MOIM_AGEE
			                     , APPR_GNDR
			                     , REGI_NAME
			                     , USER_NICK
			                     , USER_IMAG
			                     , SMAL_DATE
			                     , FULL_DATE
			                     , LIKE_COUNT
			                     , REGG_DATE
			                  FROM VW_GATHER
			                 WHERE (MEMB_COUNT/MAXX_PEOP)*100 > 70
                 )
        UNION ALL
                 (
                  			SELECT ROW_NUMBER() OVER (ORDER BY REGG_DATE DESC) RNUM
			                     , 'Region' AS TYPE
			                     , GATH_IDXX
			                     , GATH_TITL
			                     , GATH_CNTT
			                     , GATH_IMAG
			                     , CATE_IDXX
			                     , PARENTS_CATE
			                     , CHILD_CATE
			                     , PRES_PEOP
			                     , APPR_YSNO
			                     , MOIM_AGEE
			                     , APPR_GNDR
			                     , REGI_NAME
			                     , USER_NICK
			                     , USER_IMAG
			                     , SMAL_DATE
			                     , FULL_DATE
			                     , LIKE_COUNT
			                     , REGG_DATE
			                  FROM VW_GATHER
			                 WHERE REGI_CODE IN ( 
			                                     SELECT REGI_CODE
			                                       FROM TB_URREGI
			                                      WHERE USER_NUMB = 'UR23120001')
			                 )
                 		)
                 WHERE RNUM <= 8
      ]]>
   </select>
   
   <select id="getGather" parameterType='hashmap'
      resultType="hashmap">
      <![CDATA[
       	  SELECT               
                  GATH_IDXX
                , GATH_TITL
                , GATH_CNTT
                , GATH_IMAG
                , CATE_IDXX
                , PARENTS_CATE
                , CHILD_CATE
                , PRES_PEOP
                , APPR_YSNO
                , MOIM_AGEE
                , APPR_GNDR
                , REGI_NAME
                , USER_NICK
                , USER_IMAG
                , SMAL_DATE
                , FULL_DATE
                , LIKE_COUNT
                , REGG_DATE
                 ]]>
                 <if test="USER_NUMB != null">
      			 	<![CDATA[
                , getAmILike (GATH_IDXX, #{USER_NUMB}) AS LIKE_YSNO
                , getAmIBkmk (GATH_IDXX, #{USER_NUMB}) AS BKMK_YSNO					/*북마크 유무*/
                  	]]>
     			 </if>
     			  <![CDATA[
			FROM VW_GATHER
		   WHERE 1=1
      ]]>
      <if test="CATE_IDXX != null">
      	 <![CDATA[
         AND CATE_IDXX LIKE '%'||#{CATE_IDXX}||'%'
         ]]>
      </if>
   </select>
  
</mapper>